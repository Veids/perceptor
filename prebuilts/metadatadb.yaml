vars:
  db_path: &db_path !args
    name: "--metadata"
    default: "MetadataDB.db"
  target: &target !args "--steal"
chain: !Chain
  links:
    - !stdin
      &stdin
      name: Stdin

    - !extractor.PExtractor
      &icon
      name: Extract icons from PE
      entity: icon
      target: *target

    - !extractor.PExtractor
      &manifest
      name: Extract manifest from PE
      entity: manifest
      target: *target

    - !extractor.PExtractor
      &version
      name: Extract version from PE
      entity: version
      target: *target
      do_raise: True

    - !extractor.PExtractor
      &exports
      name: Extract exports from PE
      entity: exports
      target: *target

    - !extractor.PExtractor
      &rich_header
      name: Extract rich header from PE
      entity: rich_header
      target: *target

    - !extractor.PExtractor
      &optional_header
      name: Extract optional header from PE
      entity: optional_header
      target: *target

    - !signer.SigThief
      &signature
      name: Extract signature from PE
      action: store
      target: *target

    - !hiver.MetadataDB
      name: Populate metadata db
      action: store
      db: *db_path
      icon: *icon
      version: *version
      manifest: *manifest
      signature: !obj [*signature, "signature"]
      exports: !obj [*exports, "exports"]
      rich_header: !obj [*rich_header, "rich_header"]
      major_linker_version: !obj [*optional_header, "major_linker_version"]
      minor_linker_version: !obj [*optional_header, "minor_linker_version"]
